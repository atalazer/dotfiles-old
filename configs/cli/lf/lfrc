set shell sh

set previewer ~/.config/lf/preview
set cleaner ~/.config/lf/cleaner
set preview true
set ratios 1:1:2
set ignorecase true
set icons
# set drawbox

# Custom Functions
cmd open ${{
    case $(file --mime-type "$f" -bL) in
        text/*|application/json) $EDITOR "$f";;
        video/*) mpv "$f";;
        image/*) feh "$f";;
        application/pdf) zathura "$f";;
        *) opener "$f" ;;
    esac
}}

cmd mkdir ${{
    directory=$1
    if test -e "$directory"; then
        lf -remote "send $id echo Directory exists: $directory"
        exit 1
    fi
    mkdir -p "$directory"
    lf -remote "send $id select $directory"
}}

cmd bulkrename ${{
	index=$(mktemp /tmp/lf-bulk-rename-index.XXXXXXXXXX)
	if [ -n "${fs}" ]; then
		echo "$fs" > $index
	else
		echo "$(ls "$(dirname $f)" | tr ' ' "\n")" > $index
	fi
	index_edit=$(mktemp /tmp/lf-bulk-rename.XXXXXXXXXX)
	cat $index > $index_edit
	$EDITOR $index_edit
	if [ $(cat $index | wc -l) -eq $(cat $index_edit | wc -l) ]; then
		max=$(($(cat $index | wc -l)+1))
		counter=1
		while [ $counter -le $max ]; do
			a="$(cat $index | sed "${counter}q;d")"
			b="$(cat $index_edit | sed "${counter}q;d")"
			counter=$(($counter+1))

			[ "$a" = "$b" ] && continue
			[ -e "$b" ] && echo "File exists: $b" && continue
			mv "$a" "$b"
		done
	else
		echo "Number of lines must stay the same"
	fi
	rm $index $index_edit
}}

cmd touch ${{
  file=$1
  if test -e "$file"; then
    lf -remote "send $id echo File exists: $file"
    exit 1
  fi
  touch "$file"
  lf -remote "send $id select $file"
}}

cmd unarchive ${{
  extract "$f"
}}

cmd unexecute ${{
  chmod -x "$f"
}}

# Bindings
# Basic Functions
map cd push :cd<space>
map bc cd ~/.config
map bd cd ~/.dotfiles
map bl cd ~/Downloads
map bD cd ~/Documents
map br cd ~/Documents/GitHub
map bv cd ~/Videos
map bp cd ~/Pictures
map bm cd ~/Music

map . set hidden!
map p paste
map x cut
map c copy
map <enter> open

map af mkfile
map ad mkdir

map r rename
map R bulkrename
map <c-r> reload
map C clear
map U unselect
map o open_config
map gg top
map G bottom
